@model List<YuchisoftTest.Domain.Entity.StockList>
@{
    ViewData["Title"] = "Stok";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">Stok</h3>
    <button id="btnOpenCreate" class="btn btn-primary">+Stok Ekle</button>
</div>

<table id="stockListTable" class="table table-bordered table-sm align-middle">
    <thead>
        <tr>
            <th>Id</th>
            <th>Birim Kodu</th>
            <th>Açıklama</th>
            <th>Stok Tipi</th>
            <th>Miktar</th>
            <th>Kritik Miktar</th>
            <th>Raf Bilgisi</th>
            <th>Kabin Bilgisi</th>
            <th>Durum</th>
            <th style="width:180px;">İşlemler</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var x in Model)
        {
            <tr data-id="@x.Id">
                <td>@x.Id</td>
                <td>@x.StockUnit.UnitCode</td>
                <td>@x.StockUnit.Description</td>
                <td>@x.StockUnit.StockType.Name</td>
                <td>@x.Quantity @x.StockUnit.QuantityUnit</td>
                <td>@x.CriticalQuantity @x.StockUnit.QuantityUnit</td>
                <td>@x.ShelfInfo</td>
                <td>@x.CabinetInfo</td>
                <td class="@(x.IsActive ? "text-success fw-semibold" : "text-danger fw-semibold")">
                    @(x.IsActive ? "Aktif" : "İnaktif")
                </td>
                <td>
                    <button type="button" class="btn btn-sm btn-warning crud-edit" data-id="@x.Id">Düzenle</button>
                    <button type="button" class="btn btn-sm btn-danger crud-delete" data-id="@x.Id">Sil</button>
                </td>
            </tr>
        }
    </tbody>
</table>

<!-- upsert modal -->
<div class="modal fade" id="saveModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Stok</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body" id="saveModalBody">
                <!-- partial -->
            </div>

        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {

            CrudPage.init({
                tableSelector: '#stockListTable',
                modalSelector: '#saveModal',
                modalBodySelector: '#saveModalBody',
                createBtnSelector: '#btnOpenCreate',

                getModalUrl: '@Url.Action("SaveModal", "StockList")',
                saveUrl: '@Url.Action("SaveStockList", "StockList")',
                deleteUrl: '@Url.Action("DeleteStockList", "StockList")',

                mapToRow: (d) => [
                    d.id,
                    d.unitCode,
                    d.description,
                    d.stockTypeName,
                    `${d.quantity} ${d.quantityUnit}`,
                    `${d.criticalQuantity} ${d.quantityUnit}`,
                    d.shelfInfo,
                    d.cabinetInfo,
                    d.isActive
                        ? '<span class="text-success fw-semibold">Aktif</span>'
                        : '<span class="text-danger fw-semibold">İnaktif</span>',
                    CrudPage.actionsHtml(d.id)
                ],

                createToastText: 'Kayıt eklendi',
                updateToastText: 'Kayıt güncellendi',
                deleteToastText: 'Silindi'
            });
        });
    </script>
}