@model List<YuchisoftTest.Domain.Entity.StockUnit>
@{
    ViewData["Title"] = "Stok Birimleri";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">Stok Birimleri</h3>
    <button id="btnOpenCreate" class="btn btn-primary">+Stok Birimi Ekle</button>
</div>

<table id="stockUnitsTable" class="table table-bordered table-sm align-middle">
    <thead>
        <tr>
            <th>Id</th>
            <th>Birim Kodu</th>
            <th>Stok Türü</th>
            <th>Tür</th>
            <th>Açıklama</th>
            <th>Alış Fiyatı</th>
            <th>Alış Birimi</th>
            <th>Satış Fiyatı</th>
            <th>Satış Birimi</th>
            <th>Durum</th>
            <th style="width:180px;">İşlemler</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var x in Model)
        {
            <tr data-id="@x.Id">
                <td>@x.Id</td>
                <td>@x.UnitCode</td>
                <td>@x.StockType.Name</td> 
                <td>@x.QuantityUnit</td>
                <td>@x.Description</td>
                <td>@x.PurchasePrice</td>
                <td>@x.PurchaseCurrency</td>
                <td>@(x.SalePrice.HasValue ? x.SalePrice : "-")</td>
                <td>@(x.SalePrice.HasValue ? x.SaleCurrency.ToString() : "-")</td>
                <td class="@(x.IsActive ? "text-success fw-semibold" : "text-danger fw-semibold")">
                    @(x.IsActive ? "Aktif" : "İnaktif")
                </td>
                <td>
                    <button type="button" class="btn btn-sm btn-warning crud-edit" data-id="@x.Id">Düzenle</button>
                    <button type="button" class="btn btn-sm btn-danger crud-delete" data-id="@x.Id">Sil</button>
                </td>
            </tr>
        }
    </tbody>
</table>

<!-- upsert modal -->
<div class="modal fade" id="saveModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Stok Birimi</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body" id="saveModalBody">
                <!-- partial -->
            </div>

        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            CrudPage.init({
                tableSelector: '#stockUnitsTable',
                modalSelector: '#saveModal',
                modalBodySelector: '#saveModalBody',
                createBtnSelector: '#btnOpenCreate',

                getModalUrl: '@Url.Action("SaveModal", "StockUnit")',
                saveUrl: '@Url.Action("SaveStockUnit", "StockUnit")',
                deleteUrl: '@Url.Action("DeleteStockUnit", "StockUnit")',

                mapToRow: (d) => [
                    d.id,
                    d.unitCode,
                    d.stockTypeName,
                    d.quantityUnit,
                    d.description,
                    d.purchasePrice,
                    d.purchaseCurrency,
                    d.salePrice ?? '-',
                    d.salePrice ? d.saleCurrency : '-',
                    d.isActive
                        ? '<span class="text-success fw-semibold">Aktif</span>'
                        : '<span class="text-danger fw-semibold">İnaktif</span>',
                    CrudPage.actionsHtml(d.id)
                ],

                createToastText: 'Kayıt eklendi',
                updateToastText: 'Kayıt güncellendi',
                deleteToastText: 'Silindi'
            });
        });
    </script>
}
